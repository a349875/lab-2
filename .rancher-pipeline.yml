stages:
- name: repo
  steps:
  - publishImageConfig:
      dockerfilePath: ./dockerfile
      buildContext: .
      tag: a349875/k8slab01:${CICD_EXECUTION_SEQUENCE}
      pushRemote: true
      registry: index.docker.io
- name: deploy
  steps:
  - runScriptConfig:
      image: a349875/k8slab01:${CICD_EXECUTION_SEQUENCE}
      shellScript: |2-
          #!/bin/bash
          if [ `curl -s -I http://18.182.21.175:30717 | grep HTTP | awk {'print $2'}` = 404 ]
          then
          exit 0
          else
          exit 1
          fi
- name: test
  steps:
  - applyYamlConfig:
      path: ./nginx-pod-update.yaml
timeout: 60
notification: {}
